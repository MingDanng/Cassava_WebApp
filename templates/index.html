<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cassava AI - Upload</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --primary: #00b894; --dark: #2d3436; }
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab, #00b894); background-size: 400% 400%; animation: gradientBG 15s ease infinite; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 0; padding: 40px 20px; box-sizing: border-box; overflow-x: hidden; position: relative; }
        @keyframes gradientBG { 0% {background-position: 0% 50%} 50% {background-position: 100% 50%} 100% {background-position: 0% 50%} }
        
        .deco-leaf { position: fixed; z-index: 0; opacity: 0.6; pointer-events: none; animation: float 6s ease-in-out infinite; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.1)); }
        @keyframes float { 0%, 100% {transform: translateY(0) rotate(var(--r));} 50% {transform: translateY(-20px) rotate(var(--r));} }
        .l1 { top: -20px; left: -20px; width: 300px; --r: 15deg; } .l2 { top: 10%; right: -30px; width: 250px; --r: -20deg; animation-delay: 1s; } .l3 { bottom: -30px; left: -30px; width: 350px; --r: 30deg; animation-delay: 2s; } .l4 { bottom: 20%; right: -20px; width: 200px; --r: -10deg; animation-delay: 0.5s; }
        @media (max-width: 768px) { .l3, .l4 { display: none; } .l1 { width: 150px; } .l2 { width: 120px; } }

        .btn-archive { position: fixed; top: 30px; right: 30px; z-index: 100; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(5px); padding: 12px 25px; border-radius: 50px; text-decoration: none; color: var(--dark); font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: 0.3s; display: flex; align-items: center; gap: 10px; }
        .btn-archive:hover { background: white; color: var(--primary); transform: translateY(-3px); }

        .main-card { position: relative; z-index: 10; width: 100%; max-width: 1000px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); border-radius: 30px; padding: 60px; box-shadow: 0 25px 70px rgba(0, 0, 0, 0.2); text-align: center; border: 1px solid rgba(255, 255, 255, 0.5); box-sizing: border-box; }
        

        h1 {
            color: #009432;           
            font-weight: 800;
            margin: 0 0 15px 0;
            font-size: 48px;         
            text-transform: uppercase; 
            letter-spacing: 2px;
            line-height: 1.2;
        }

        .upload-area { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; height: 350px; background: #f8f9fa; border: 4px dashed #b2bec3; border-radius: 20px; cursor: pointer; transition: all 0.3s ease; box-sizing: border-box; }
        .upload-area:hover { background: #e3f9e5; border-color: var(--primary); transform: scale(1.02); }

        /* Camera Styles */
        #camera-container { display: none; flex-direction: column; align-items: center; width: 100%; }
        video { width: 100%; max-width: 500px; border-radius: 15px; border: 4px solid var(--primary); margin-bottom: 20px; }
        
        .btn-cam { padding: 12px 30px; border-radius: 50px; font-weight: bold; cursor: pointer; border: none; font-size: 16px; margin: 5px; transition: 0.3s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-blue { background: #0984e3; color: white; margin-bottom: 20px; } .btn-blue:hover { background: #74b9ff; transform: translateY(-2px); }
        .btn-green { background: #00b894; color: white; margin-bottom: 20px; } .btn-green:hover { background: #55efc4; transform: translateY(-2px); }
        .btn-capture { background: #ff7675; color: white; } .btn-capture:hover { background: #d63031; transform: scale(1.05); }

        #loadingOverlay { display: none; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.95); z-index: 9999; justify-content: center; align-items: center; flex-direction: column; color: #00f2ff; }
        .hourglass { font-size: 80px; animation: spin 2s infinite linear; margin-bottom: 30px; } @keyframes spin { 100% {transform: rotate(180deg);} }
        .creator-signature { position: fixed; bottom: 20px; right: 20px; background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); padding: 10px 20px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.3); font-size: 13px; color: white; font-weight: 500; text-shadow: 0 1px 2px rgba(0,0,0,0.3); z-index: 1000; }
    </style>
</head>
<body>
    <a href="{{ url_for('archive_page') }}" class="btn-archive"><i class="fas fa-folder-open"></i> Archive</a>
    <img src="/static/leaf1.png" class="deco-leaf l1"><img src="/static/leaf2.png" class="deco-leaf l2"><img src="/static/leaf3.png" class="deco-leaf l3"><img src="/static/leaf4.png" class="deco-leaf l4">

    <div class="main-card">
        <h1><i class="fas fa-seedling"></i> AI Cassavas Lab</h1>
        <p style="color: #636e72; margin-bottom: 40px;">Advanced Deep Learning Diagnosis System</p>

        <button onclick="toggleCamera()" id="switchBtn" class="btn-cam btn-blue">
            <i class="fas fa-camera"></i> Switch to Camera Mode
        </button>

        <form action="/" method="post" enctype="multipart/form-data" id="uploadForm">
            <input type="file" name="my_image" id="fileInput" accept="image/*" hidden onchange="submitForm()">
            <label for="fileInput" class="upload-area" id="uploadLabel">
                <i class="fas fa-cloud-upload-alt" style="font-size: 80px; color: #00b894; margin-bottom: 25px;"></i>
                <div style="font-size: 24px; font-weight: 600; color: #636e72;">Tap to Upload</div>
                <div style="font-size: 16px; color: #b2bec3; margin-top: 10px;">Supports: JPG, PNG, JPEG</div>
            </label>
        </form>

        <div id="camera-container">
            <video id="video" autoplay playsinline></video>
            <button onclick="captureImage()" class="btn-cam btn-capture"><i class="fas fa-dot-circle"></i> Capture & Analyze</button>
            <canvas id="canvas" style="display:none;"></canvas>
        </div>
    </div>

    <div id="loadingOverlay"><i class="fas fa-hourglass-half hourglass"></i><div style="font-family: monospace; font-size: 24px;">PROCESSING...</div></div>
    <div class="creator-signature"><i class="fas fa-code"></i> @ Developed by <b>Nguyen Phuc Minh Dang</b></div>

    <script>
        function submitForm() {
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.getElementById('uploadForm').submit();
        }

        let stream = null;
        async function toggleCamera() {
            const uploadLabel = document.getElementById('uploadLabel');
            const camContainer = document.getElementById('camera-container');
            const btn = document.getElementById('switchBtn'); 
            
            if (camContainer.style.display === 'flex') {
                camContainer.style.display = 'none';
                uploadLabel.style.display = 'flex';
                if(stream) stream.getTracks().forEach(track => track.stop());
                btn.innerHTML = '<i class="fas fa-camera"></i> Switch to Camera Mode';
                btn.className = "btn-cam btn-blue";
            } else {
                uploadLabel.style.display = 'none';
                camContainer.style.display = 'flex';
                try {
                    stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                    document.getElementById('video').srcObject = stream;
                    btn.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Switch to Upload Mode';
                    btn.className = "btn-cam btn-green";
                } catch (err) {
                    alert("Camera access denied or error!");
                    uploadLabel.style.display = 'flex';
                    camContainer.style.display = 'none';
                }
            }
        }

        function captureImage() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            canvas.toBlob(function(blob) {
                const file = new File([blob], "capture.jpg", { type: "image/jpeg" });
                const container = new DataTransfer();
                container.items.add(file);
                document.getElementById('fileInput').files = container.files;
                submitForm();
            }, 'image/jpeg');
        }
    </script>
</body>
</html>